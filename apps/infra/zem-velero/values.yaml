# Parent-chart (zem-velero) config: enable in-cluster rclone S3 gateway
rclone:
  enabled: true
  # rclone image to use for the S3 gateway
  image: rclone/rclone:latest
  # Name of the Kubernetes secret (contains rclone.conf) that will be mounted
  configSecretName: rclone-config
  # Service name exposed in-cluster (Velero will point at this hostname)
  serviceName: velero-rclone-s3
  servicePort: 9000
  networkPolicy:
    enabled: true
    # Default: only allow pods labelled app.kubernetes.io/name=velero in this namespace.
    allowedPodSelector:
      matchLabels:
        app.kubernetes.io/name: velero
    # Optional: allow pods from namespaces matching these labels.
    # Disabled by default â€” enable and set matchLabels per-cluster if you need cross-namespace access.
    allowedNamespaces:
      enabled: false
      matchLabels: {}
  externalSecret:
    enabled: true
    # Target secret name that ExternalSecret will create (Velero will reference it)
    targetSecretName: velero-rclone-credentials

# Values for the velero subchart (must be under "velero")
velero:
  # Minimal opinionated values: enable Velero node-agent (restic)
  deployNodeAgent: true

  # Tell Velero to use a secret (created by ExternalSecret) for S3 credentials
  credentials:
    useSecret: true
    existingSecret: velero-rclone-credentials

  # Configure BackupStorageLocation to use the local rclone S3 gateway. Velero and
  # the rclone gateway are installed into the same namespace by default, so the
  # ClusterIP service `velero-rclone-s3` is addressable at the short name.
  configuration:
    backupStorageLocation:
      - name: default
        provider: aws
        bucket: velero
        config:
          s3ForcePathStyle: "true"
          s3Url: http://velero-rclone-s3:9000
        default: true
